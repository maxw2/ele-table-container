<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <!-- <script src="https://cdn.jsdelivr.net/npm/vue@2.7.14"></script> -->
    <!-- <script src="https://unpkg.com/element-ui/lib/index.js"></script> -->
    <script src="https://cdn.jsdelivr.net/npm/vue@2.7.14"></script>
    <script src="https://unpkg.com/element-ui/lib/index.js"></script>
    <link
      rel="stylesheet"
      href="https://unpkg.com/element-ui/lib/theme-chalk/index.css"
    />
  </head>

  <body>
    <div id="app"></div>
  </body>
  <script type="text/x-template" id="template">
    <div>
        <el-table :data='adata' ref='table1' height='200px' >
            <el-table-column v-for="val in columns" :label="val.label" :prop="val.prop"></el-table-column>
            <!-- <el-table-column prop='zip' label='合并' >
                <el-table-column prop='id' label='序号' />
                <el-table-column prop='zip' label='合并' />
            </el-table-column>
            <el-table-column prop='zip' label='合并' /> -->
        </el-table>
        <!-- el-table -->
        <!-- <ele-table class='ele-table' ref='table' height='200px'
        :data="tdata"
        :columns="columns"
        :row-key="getRowKey"
        :default-expand-all="false"
        :expand-row-keys="[1,2]"
        :vertual='true'
        @select-all="selectAll"
        @selection-change="selectionChange"
        @row-click='rowClick'
        @select='select'
        :span-method="arraySpanMethod"
        /> -->
            <div style='height: 1000px'>
                <ele-table class='ele-table' ref='table' :height='height'
                :data="tdata"
                :columns="columns"
                :row-key="(row) => row.id"
                :default-expand-all="false"
                :expand-row-keys="[1,2]"
                :vertual='true'
                @select-all="selectAll"
                @selection-change="selectionChange"
                @row-click='rowClick'
                @select='select'
                @dataChang="(v)=> this.adata = v"
                :bufferCount="0"
                >
        <template slot='append'>
            <el-button >123123</el-button>
        </template>
    </ele-table>


                <ele-table class='ele-table' ref='table' :height='height'
                    :data="tdata"
                    :columns="columns"
                    :row-key="getRowKey"
                    :default-expand-all="false"
                    :expand-row-keys="[1,2]"
                    :vertual='true'
                    @select-all="selectAll"
                    @selection-change="selectionChange"
                    @row-click='rowClick'
                    @select='select'
                    @dataChang="(v)=> this.adata = v"
                    :bufferCount="0"
                    :merge="['zip']"
                    >
            <template slot='append'>
                <el-button >123123</el-button>
            </template>
        </ele-table>
            </div>
        <!-- table -->

        <el-button @click="onClick">toggleAllSelection</el-button>
        <el-button @click='getData(2000)'>ajax</el-button>
        <el-input v-model='height'></el-input>
    </div>
  </script>
  <script type="module">
    import { Table, TableContainer } from "./lib/ele-table.js";

    new Vue({
      el: "#app",
      components: {
        eleTable: Table,
        eleTableContainer: TableContainer,
      },
      template: "#template",
      data: {
        height: "600px",
        pageOpt: {
          background: true,
          layout: "prev, pager, next",
          total: 100,
        },
        columns: [
          {
            label: "左侧固定",
            render(h, props) {
              return h("div", "左侧");
            },
            // fixed: 'left'
          },
          {
            prop: "name",
            label: "姓",
            // width: "300",
            sortable: true,
            render(h, props) {
              return props.row.id % 2 === 0
                ? [
                    h("el-button", props.row.name),
                    h("el-button", props.row.name),
                  ]
                : h("el-button", props.row.name);
            },
            // fixed: "left",
          },
          {
            prop: "random",
            label: "RANDOM",
            render(h, prop) {
              return Array.from(Array(prop.row.random), () =>
                h("el-button", prop.row.random)
              );
            },
            width: "100",
            // fixed: 'left'
          },
          {
            type: "selection",
            label: "序号",
            reserveSelection: "true",
            // fixed: 'left'
          },
          {
            type: "index",
            label: "序号",
          },
          {
            label: "基础数据",
            children: [
              {
                prop: "date",
                label: "日期",
              },
            ],
          },
          {
            prop: "zip",
            label: "合并",
            width: "500",
          },
          {
            prop: "address",
            label: "地址",
            width: "500",
          },
        ],
        adata: [],
        tdata: [],
      },
      mounted() {
        this.getData(2000);
      },
      methods: {
        getData(time) {
          setTimeout(() => {
            this.tdata = Array.from(new Array(500)).map((val, index) => {
              const random = Math.floor(Math.random() * 3);
              return {
                id: index,
                date: `2016-05-${Math.floor(Math.random() * 5)}`,
                name: "王小虎",
                address: `上海市普陀区金沙江路 ${index} 弄`,
                city: "普陀区",
                zip: Math.floor(Math.random() * 5),
                random: random,
              };
            });
          }, time);
        },

        getRowKey(row) {
          return row.name;
        },
        selectAll(selection) {
          console.log(selection, "##selectAll##");
        },
        selectionChange(selection) {
          console.log(selection, "##selectionChange##");
        },
        onClick() {
          console.log(this.$refs.table.$children[0]);
          this.tdata.forEach((row) => {
            this.$refs.table.$children[0].toggleRowSelection(row, true);
          });
        },
        rowClick(row, column, event) {
          const selection =
            this.$refs.table.$children[0].store.states.selection;
          selection.forEach((val) => {
            if (val === row) console.log("true");
          });
          console.log(
            row,
            "rowClick",
            this.$refs.table.$children[0].store.states.selection
          );
        },
        select(selection, row) {
          console.log("select", selection, row);
          selection.forEach((val) => {
            if (val === row) console.log("select-true");
          });
        },
        expandChange(row, expandedRows) {
          console.log(row, expandedRows, "expandChange");
        },
      },
    });
  </script>
  <style>
    .demo-table-expand {
      font-size: 0;
    }

    .demo-table-expand label {
      width: 90px;
      color: #99a9bf;
    }

    .demo-table-expand .el-form-item {
      margin-right: 0;
      margin-bottom: 0;
      width: 50%;
    }
  </style>
</html>
