function t(){return t=Object.assign?Object.assign.bind():function(t){for(var e,r=1;r<arguments.length;r++)for(var n in e=arguments[r])Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t},t.apply(this,arguments)}var e=["attrs","props","domProps"],r=["class","style","directives"],n=["on","nativeOn"],i=function(i){return i.reduce((function(i,l){for(var a in l)if(i[a])if(-1!==e.indexOf(a))i[a]=t({},i[a],l[a]);else if(-1!==r.indexOf(a)){var s=i[a]instanceof Array?i[a]:[i[a]],u=l[a]instanceof Array?l[a]:[l[a]];i[a]=[].concat(s,u)}else if(-1!==n.indexOf(a))for(var c in l[a])if(i[a][c]){var f=i[a][c]instanceof Array?i[a][c]:[i[a][c]],h=l[a][c]instanceof Array?l[a][c]:[l[a][c]];i[a][c]=[].concat(f,h)}else i[a][c]=l[a][c];else if("hook"===a)for(var p in l[a])i[a][p]=i[a][p]?o(i[a][p],l[a][p]):l[a][p];else i[a]=l[a];else i[a]=l[a];return i}),{})},o=function(t,e){return function(){t&&t.apply(this,arguments),e&&e.apply(this,arguments)}};function l(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function a(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?l(Object(r),!0).forEach((function(e){s(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):l(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function s(t,e,r){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function u(t){return function(t){if(Array.isArray(t))return c(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return c(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return c(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function c(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}var f={name:"eleColumn",functional:!0,components:{eleColumn:f},render:function(t,e){var r=e.props,n=r.globalSlots||null;return t("el-table-column",i([{},{props:r},{scopedSlots:function(t,e){return e.render?{default:function(r){return e.render(t,r)}}:{}}(t,r)}]),[r.children?r.children.map((function(e){return t(f,i([{},{props:a(a({},e),{},{globalSlots:n})}]))})):null])}};function h(t,e,r){var n=!1,i=t.indexOf(e),o=-1!==i,l=function(){t.push(e),n=!0},a=function(){t.splice(i,1),n=!0};return"boolean"==typeof r?r&&!o?l():!r&&o&&(console.log("removeRow",i),a()):o?a():l(),n}var p=function(t,e){var r={};return(t||[]).forEach((function(t,n){r[d(t,e)]={row:t,index:n}})),r},d=function(t,e){if(!t)throw new Error("row is required when get row identity");if("string"==typeof e){if(e.indexOf(".")<0)return t[e];for(var r=e.split("."),n=t,i=0;i<r.length;i++)n=n[r[i]];return n}if("function"==typeof e)return e.call(null,t)},g={name:"eleTable",components:{eleColumn:f},data:function(){return{item:[],tableRef:null,warpperRef:null,elWarp:null,elItems:null,elWarpHeight:null,itemHeight:48,itemHeightArr:[],vCount:7,bufferCount:5,bufferHeight:0,startIdx:0,selections:[],btn:!0}},props:{data:{type:Array,default:function(){return[]}},columns:{type:Array,default:function(){return[]}}},watch:{data:function(t){this.elWarp.style.height=this.elItems*t.length+"px"}},computed:{vData:function(){var t=this.bufferIdx,e=this.startIdx+this.vCount+this.bufferCount;return this.data.slice(t,e)},vColumns:function(){return this.columns.map((function(t){if("selection"===t.type)return a(a({},t),{},{renderHeader:function(t,e){return t("el-button","1ds")}})}))},bufferIdx:function(){return this.startIdx-this.bufferCount>0?this.startIdx-this.bufferCount:0},globalHeight:function(){return this.data.length*this.itemHeight},isAllSelected:function(){var t=this;setTimeout((function(){var e=t.data.length===t.selections.length;return console.log(e,"isAllSelected"),e}))}},mounted:function(){this.initProxy(),console.log("mounted")},updated:function(){console.log("updated")},methods:{initProxy:function(){var t=this;var e=this.warpperRef.wrappedRowRender;this.warpperRef.wrappedRowRender=function(r,n){return e(r,n+t.bufferIdx)},this.tableRef.store.toggleAllSelection=function(){var e=this.states;e.data;var r=e.selection,n=e.selectOnIndeterminate?!e.isAllSelected:!(e.isAllSelected||r.length);e.isAllSelected=n;var i=!1;t.data.forEach((function(t,o){e.selectable?e.selectable.call(null,t,o)&&h(r,t,n)&&(i=!0):h(r,t,n)&&(i=!0)})),i&&this.table.$emit("selection-change",r?r.slice():[]),this.table.$emit("select-all",r)},this.tableRef.store.updateAllSelected=function(){var e=this.states,r=e.selection,n=e.rowKey,i=e.selectable,o=t.data||[];if(0!==o.length){var l;n&&(l=p(r,n));for(var a,s=!0,u=0,c=0,f=o.length;c<f;c++){var h=o[c],g=i&&i.call(null,h,c);if(a=h,l?l[d(a,n)]:-1!==r.indexOf(a))u++;else if(!i||g){s=!1;break}}0===u&&(s=!1),e.isAllSelected=s}else e.isAllSelected=!1}},refCallBack:function(t){var e=this;this.tableRef||(this.tableRef=t,this.tableRef.$children.forEach((function(t){"ElTableBody"===t.$options.name&&(e.warpperRef=t)})),this.tbody=this.warpperRef.$el.querySelectorAll("tbody"),this.appendWarp(),this.$nextTick((function(){e.bufferItemArr()})))},bufferItemArr:function(){var t=this;u(this.elWarp.querySelectorAll("tr")).forEach((function(e,r){t.bufferIdx&&t.itemHeight}))},appendWarp:function(){var t=this,e=this.tableRef.$el;this.elWarp=document.createElement("div"),this.elWarp.className="ele-vertual-warp",this.elWarp.style.height=this.globalHeight+"px",this.elItems=document.createElement("div"),this.elItems.className="ele-vertual-warpItems";var r=e.querySelector(".el-table__body-wrapper"),n=r.querySelector("table");setTimeout((function(){t.itemHeight=r.querySelector("tr").offsetHeight,console.log(r.querySelector("tr").offsetHeight,"clientHeight",n.clientHeight/13)})),r.insertBefore(this.elWarp,n),this.elItems.appendChild(n),this.elWarp.appendChild(this.elItems),r.addEventListener("scroll",this.eventScroll.bind(this))},eventScroll:function(t){var e=t.target.scrollTop;this.startIdx=Math.floor(e/this.itemHeight);var r=(this.startIdx-this.bufferIdx)*this.itemHeight,n=e-e%this.itemHeight-r;console.log(r,"buffTop",e),console.log(e%this.itemHeight),this.elWarp.style.height=this.globalHeight-n+"px",this.elWarp.style.transform="translate3d(0, ".concat(n,"px, 0)"),this.bufferItemArr()}},render:function(t){var e=this;return this.$attrs,t("el-table",i([{attrs:{data:this.vData}},{attrs:this.$attrs},{ref:this.refCallBack},{on:this.$listeners}]),[this.columns.map((function(r){return t(f,i([{},{props:a(a({},r),{},{globalSlots:e.$slots})}]))})),t("template",{slot:"append"},[this.$slots.append])])}},b={name:"eleTableContainer",components:{eleTable:g},data:function(){return{loading:!1}},methods:{getAxios:function(){var t=this;this.loading=!0,this.getData().finally((function(){t.loading=!1}))},sizeChange:function(t){var e=this;this.pProps.pageSize=t,this.loading=!0,this.getData().finally((function(){e.loading=!1}))},currentChange:function(t){var e=this;this.pProps.currentPage=t,this.loading=!0,this.getData().finally((function(){e.loading=!1}))}},mounted:function(){this.getAxios()},computed:{tProps:function(){return this.$attrs},pProps:function(){return this.$attrs.pageOpt},getData:function(){return this.$attrs.getData}},render:function(t,e){return t("div",{class:"ele-table-container"},[t("ele-table",i([{},{props:this.tProps},{directives:[{name:"loading",value:this.loading}]}])),t("el-pagination",i([{},{props:this.pProps},{},{on:{"size-change":this.sizeChange,"current-change":this.currentChange}}]))])}};export{g as Table,b as TableContainer};
