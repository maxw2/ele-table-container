function t(){return t=Object.assign?Object.assign.bind():function(t){for(var e,r=1;r<arguments.length;r++)for(var n in e=arguments[r])Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t},t.apply(this,arguments)}var e=["attrs","props","domProps"],r=["class","style","directives"],n=["on","nativeOn"],i=function(i){return i.reduce((function(i,o){for(var s in o)if(i[s])if(-1!==e.indexOf(s))i[s]=t({},i[s],o[s]);else if(-1!==r.indexOf(s)){var l=i[s]instanceof Array?i[s]:[i[s]],u=o[s]instanceof Array?o[s]:[o[s]];i[s]=[].concat(l,u)}else if(-1!==n.indexOf(s))for(var h in o[s])if(i[s][h]){var f=i[s][h]instanceof Array?i[s][h]:[i[s][h]],p=o[s][h]instanceof Array?o[s][h]:[o[s][h]];i[s][h]=[].concat(f,p)}else i[s][h]=o[s][h];else if("hook"===s)for(var c in o[s])i[s][c]=i[s][c]?a(i[s][c],o[s][c]):o[s][c];else i[s]=o[s];else i[s]=o[s];return i}),{})},a=function(t,e){return function(){t&&t.apply(this,arguments),e&&e.apply(this,arguments)}};function o(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function s(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?o(Object(r),!0).forEach((function(e){l(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):o(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function l(t,e,r){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function u(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var n,i,a,o,s=[],l=!0,u=!1;try{if(a=(r=r.call(t)).next,0===e){if(Object(r)!==r)return;l=!1}else for(;!(l=(n=a.call(r)).done)&&(s.push(n.value),s.length!==e);l=!0);}catch(t){u=!0,i=t}finally{try{if(!l&&null!=r.return&&(o=r.return(),Object(o)!==o))return}finally{if(u)throw i}}return s}}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return h(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return h(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function h(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}var f={name:"eleColumn",functional:!0,components:{eleColumn:f},render:function(t,e){var r=e.props,n=r.globalSlots||null;return t("el-table-column",i([{},{props:r},{scopedSlots:function(t,e){return e.render?{default:function(r){return e.render(t,r)}}:{}}(t,r)}]),[r.children?r.children.map((function(e){return t(f,i([{},{props:s(s({},e),{},{globalSlots:n})}]))})):null])}};function p(t,e){var r=null;return function(){for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];r||(r=setTimeout((function(){t.apply(void 0,i),r=null}),e))}}function c(t,e,r){var n=!1,i=t.indexOf(e),a=-1!==i,o=function(){t.push(e),n=!0},s=function(){t.splice(i,1),n=!0};return"boolean"==typeof r?r&&!a?o():!r&&a&&s():a?s():o(),n}var d=function(t,e){var r={};return(t||[]).forEach((function(t,n){r[g(t,e)]={row:t,index:n}})),r},g=function(t,e){if(!t)throw new Error("row is required when get row identity");if("string"==typeof e){if(e.indexOf(".")<0)return t[e];for(var r=e.split("."),n=t,i=0;i<r.length;i++)n=n[r[i]];return n}if("function"==typeof e)return e.call(null,t)},m={data:function(){return{posMap:[],position:[]}},props:{vertual:{type:Boolean,default:!0},estimatedHeight:{type:Number,default:0}},updated:function(){this.getposMap()},methods:{getposMap:function(){var t=this,e=this.elWarp.querySelectorAll("tr"),r=this.startIdx-this.bufferCount>0?this.startIdx-this.bufferCount:0,n=this.position[r-1]||0;e.forEach((function(e,i){n+=e.offsetHeight,t.posMap[r+i]=n,t.position[r+i]=n}))},getPosition:function(){var t=this,e=[],r=0;return this.data.map((function(n,i){var a=t.posMap[i];a?r=a:r+=t.estimatedHeight||t.itemHeight,e[i]=r})),this.position=e,e},getPosIdx:function(t){var e=this.position.findIndex((function(e){return t<=e}));return[e,this.position[e-1]?this.position[e]-this.position[e-1]:this.position[e],this.position[e]]}}},b={name:"eleTable",components:{eleColumn:f},mixins:[{data:function(){return{tableRef:null,warpperRef:null,elWarp:null,elItems:null,elTbody:null}},mounted:function(){this.getTableRef()},methods:{getTableRef:function(){var t=this;this.tableRef||(this.tableRef=this.$children[0],this.tableRef.$children.forEach((function(e){"ElTableBody"===e.$options.name&&(t.warpperRef=e)})),this.elTbody=this.warpperRef.$el.querySelector("tbody"),this.initProxy(),this.appendWarp())},initProxy:function(){var t=this,e=this.warpperRef.wrappedRowRender;this.warpperRef.wrappedRowRender=function(r,n){return e(r,n+t.bufferIdx)}},appendWarp:function(){var t=this.tableRef.$el;this.elWarp=document.createElement("div"),this.elWarp.className="ele-vertual-warp",this.elWarp.style.position="relative",this.elItems=document.createElement("div"),this.elItems.className="ele-vertual-warpItems",this.elItems.style.position="absolute",this.elItems.style.left="0px",this.elItems.style.top="0px";var e=t.querySelector(".el-table__body-wrapper"),r=e.querySelector("table");e.insertBefore(this.elWarp,r),this.elItems.appendChild(r),this.elWarp.appendChild(this.elItems);var n=t.querySelector(".el-table__fixed .el-table__fixed-body-wrapper");if(n){this.leftWarp=document.createElement("div"),this.leftWarp.className="ele-vertual-warp-right";var i=n.querySelector("table");n.insertBefore(this.leftWarp,i),this.leftWarp.appendChild(i)}var a=t.querySelector(".el-table__fixed-right .el-table__fixed-body-wrapper");if(a){this.rightWarp=document.createElement("div"),this.rightWarp.className="ele-vertual-warp-right";var o=a.querySelector("table");a.insertBefore(this.rightWarp,o),this.rightWarp.appendChild(o)}e.addEventListener("scroll",p.call(this,this.eventScroll,0))},initItemHeight:function(){if(this.itemHeight)return this.itemHeight;var t=this.elTbody.offsetHeight/(this.vCount+this.bufferCount);return this.itemHeight=Math.round(t),this.tableRef.$el.offsetHeight,this.elWarp.style.height=this.globalHeight+"px",this.itemHeight},getGloHeight:function(){return console.log(this.position,this.data.length-1,"globalHeight",this.position[this.data.length-1]||0),this.vertual?this.position[this.data.length-1]||0:this.data.length*this.itemHeight}}},{mounted:function(){this.initSelection()},methods:{initSelection:function(){if(!this.tableRef)throw new Error("MODULE-SELECTION: tableRef is undefined");var t=this;this.tableRef.store.toggleAllSelection=function(){var e=this.states,r=e.selection,n=e.selectOnIndeterminate?!e.isAllSelected:!(e.isAllSelected||r.length);e.isAllSelected=n;var i=!1;t.data.forEach((function(t,a){e.selectable?e.selectable.call(null,t,a)&&c(r,t,n)&&(i=!0):c(r,t,n)&&(i=!0)})),i&&this.table.$emit("selection-change",r?r.slice():[]),this.table.$emit("select-all",r)},this.tableRef.store.updateAllSelected=function(){var e=this.states,r=e.selection,n=e.rowKey,i=e.selectable,a=t.data||[];if(0!==a.length){var o;n&&(o=d(r,n));for(var s,l=!0,u=0,h=0,f=a.length;h<f;h++){var p=a[h],c=i&&i.call(null,p,h);if(s=p,o?o[g(s,n)]:-1!==r.indexOf(s))u++;else if(!i||c){l=!1;break}}0===u&&(l=!1),e.isAllSelected=l}else e.isAllSelected=!1}}}},m,{data:function(){return{originSpanMehtod:[],curRowSpan:{},mergeKeyIndex:[],mergeMap:{},bufferMergeMap:{},bufferBtn:0}},props:{merge:{type:Array,default:function(){return[]}}},created:function(){this.initSpanMethod(),this.mergeKeyIndex=this.getMergeKeyIndex(this.columns)},mounted:function(){this.initMergeMap(this.data)},beforeUpdate:function(){console.log("update"),this.bufferBtn=0},methods:{initSpanMethod:function(){this.$attrs["span-method"]||this.merge&&(this.$attrs["span-method"]=this.handlerMerge)},initMergeMap:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.data,r={};e.map((function(n,i){var a=e[i+1]||{};t.merge.forEach((function(e){t.mergeMap[e]||(t.mergeMap[e]=[]),n[e]===a[e]?r[e]?(t.mergeMap[e].push({rowspan:0,colspan:1}),r[e].rowspan+=1):(r[e]={rowspan:1,colspan:1},t.mergeMap[e].push(r[e])):(r[e]?(r[e].rowspan+=1,t.mergeMap[e].push({rowspan:0,colspan:1})):t.mergeMap[e].push({rowspan:1,colspan:1}),r[e]=null)}))})),console.log(this.mergeMap)},fixBufferMergeMap:function(t,e){return e===this.bufferIdx?0===this.mergeMap[t][this.bufferIdx].rowspan?{rowspan:this.mergeMap[t].slice(this.bufferIdx).findIndex((function(t){return 0!==t.rowspan})),colspan:1}:this.mergeMap[t][this.bufferIdx]:this.mergeMap[t][e]},getMergeKeyIndex:function(t){function e(t,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i={};return t.forEach((function(t,a){t.prop===r?i={key:r,index:a+n}:t.children&&(i=e(t.children,r,a))})),i}return this.merge.map((function(r){return e(t,r)}))},handlerMerge:function(t){var e=this,r=t.rowIndex,n=t.columnIndex,i=[1,1];return this.mergeKeyIndex.forEach((function(t){var a=t.key,o=t.index;n===o&&(i=e.fixBufferMergeMap(a,r))})),i}}}],data:function(){return{itemHeight:0,vCount:10,startIdx:0,selections:[],WeakMap:new Map,posMap:[],btn:!0}},props:{data:{type:Array,default:function(){return[]}},columns:{type:Array,default:function(){return[]}},bufferCount:{type:Number,default:0}},computed:{vData:function(){var t=this.bufferIdx,e=this.startIdx+this.vCount+this.bufferCount;return this.data.slice(t,e)},bufferIdx:function(){return this.startIdx-this.bufferCount>0?this.startIdx-this.bufferCount:0},globalHeight:function(){return this.vertual?this.position[this.data.length-1]||0:(this.elWarp.style.height=this.data.length*this.itemHeight+"px",this.data.length*this.itemHeight)}},mounted:function(){var t=this;console.log("mounted",this),this.$nextTick((function(){t.updateAllData()}))},methods:{updateAllData:function(){var t=this;this.$nextTick((function(){t.initItemHeight(),t.getPosition(),t.getposMap(),t.eventScroll()}))},eventScroll:function(t){var e,r=(null==t||null===(e=t.target)||void 0===e?void 0:e.scrollTop)||0,n=0;if(!this.vertual){this.startIdx=Math.floor(r/this.itemHeight);var i=(this.startIdx-this.bufferIdx)*this.itemHeight;n=r-r%this.itemHeight-i}if(this.vertual){var a=u(this.getPosIdx(r),3),o=a[0],s=a[1],l=a[2];this.startIdx=o,n=l-s}this.elWarp.style.height=this.globalHeight-n+"px",this.elWarp.style.transform="translate3d(0, ".concat(n,"px, 0)"),this.leftWarp&&(this.leftWarp.style.height=this.globalHeight-n+"px",this.leftWarp.style.transform="translate3d(0, ".concat(n,"px, 0)")),this.rightWarp&&(this.rightWarp.style.height=this.globalHeight-n+"px",this.rightWarp.style.transform="translate3d(0, ".concat(n,"px, 0)"))}},render:function(){var t=this,e=arguments[0];return e("el-table",i([{attrs:{data:this.vData}},{attrs:this.$attrs},{},{on:this.$listeners}]),[this.columns.map((function(r){return e(f,i([{},{props:s(s({},r),{},{globalSlots:t.$slots})}]))})),e("template",{slot:"append"},[this.$slots.append])])}},v={name:"eleTableContainer",components:{eleTable:b},data:function(){return{loading:!1}},methods:{getAxios:function(){var t=this;this.loading=!0,this.getData().finally((function(){t.loading=!1}))},sizeChange:function(t){var e=this;this.pProps.pageSize=t,this.loading=!0,this.getData().finally((function(){e.loading=!1}))},currentChange:function(t){var e=this;this.pProps.currentPage=t,this.loading=!0,this.getData().finally((function(){e.loading=!1}))}},mounted:function(){this.getAxios()},computed:{tProps:function(){return this.$attrs},pProps:function(){return this.$attrs.pageOpt},getData:function(){return this.$attrs.getData}},render:function(){var t=arguments[0];return t("div",{class:"ele-table-container"},[t("ele-table",i([{},{props:this.tProps},{directives:[{name:"loading",value:this.loading}]}])),t("el-pagination",i([{},{props:this.pProps},{},{on:{"size-change":this.sizeChange,"current-change":this.currentChange}}]))])}};export{b as Table,v as TableContainer};
