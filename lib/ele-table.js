function t(){return t=Object.assign?Object.assign.bind():function(t){for(var e,i=1;i<arguments.length;i++)for(var n in e=arguments[i])Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t},t.apply(this,arguments)}var e=["attrs","props","domProps"],i=["class","style","directives"],n=["on","nativeOn"],r=function(r){return r.reduce((function(r,o){for(var l in o)if(r[l])if(-1!==e.indexOf(l))r[l]=t({},r[l],o[l]);else if(-1!==i.indexOf(l)){var s=r[l]instanceof Array?r[l]:[r[l]],u=o[l]instanceof Array?o[l]:[o[l]];r[l]=[].concat(s,u)}else if(-1!==n.indexOf(l))for(var h in o[l])if(r[l][h]){var f=r[l][h]instanceof Array?r[l][h]:[r[l][h]],c=o[l][h]instanceof Array?o[l][h]:[o[l][h]];r[l][h]=[].concat(f,c)}else r[l][h]=o[l][h];else if("hook"===l)for(var p in o[l])r[l][p]=r[l][p]?a(r[l][p],o[l][p]):o[l][p];else r[l]=o[l];else r[l]=o[l];return r}),{})},a=function(t,e){return function(){t&&t.apply(this,arguments),e&&e.apply(this,arguments)}};function o(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,n)}return i}function l(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?o(Object(i),!0).forEach((function(e){s(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):o(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function s(t,e,i){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var n=i.call(t,e||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function u(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var i=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=i){var n,r,a,o,l=[],s=!0,u=!1;try{if(a=(i=i.call(t)).next,0===e){if(Object(i)!==i)return;s=!1}else for(;!(s=(n=a.call(i)).done)&&(l.push(n.value),l.length!==e);s=!0);}catch(t){u=!0,r=t}finally{try{if(!s&&null!=i.return&&(o=i.return(),Object(o)!==o))return}finally{if(u)throw r}}return l}}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return h(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);"Object"===i&&t.constructor&&(i=t.constructor.name);if("Map"===i||"Set"===i)return Array.from(t);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return h(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function h(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=t[i];return n}var f={name:"eleColumn",functional:!0,components:{eleColumn:f},render:function(t,e){var i=e.props,n=i.globalSlots||null;return t("el-table-column",r([{},{props:i},{scopedSlots:function(t,e){return e.render?{default:function(i){return e.render(t,i)}}:{}}(t,i)}]),[i.children?i.children.map((function(e){return t(f,r([{},{props:l(l({},e),{},{globalSlots:n})}]))})):null])}};function c(t,e){var i=null;return function(){for(var n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];i||(i=setTimeout((function(){t.apply(void 0,r),i=null}),e))}}function p(t,e,i){var n=!1,r=t.indexOf(e),a=-1!==r,o=function(){t.push(e),n=!0},l=function(){t.splice(r,1),n=!0};return"boolean"==typeof i?i&&!a?o():!i&&a&&l():a?l():o(),n}var d=function(t,e){var i={};return(t||[]).forEach((function(t,n){i[g(t,e)]={row:t,index:n}})),i},g=function(t,e){if(!t)throw new Error("row is required when get row identity");if("string"==typeof e){if(e.indexOf(".")<0)return t[e];for(var i=e.split("."),n=t,r=0;r<i.length;r++)n=n[i[r]];return n}if("function"==typeof e)return e.call(null,t)},b={data:function(){return{posMap:[],position:[]}},props:{vertual:{type:Boolean,default:!0},estimatedHeight:{type:Number,default:0}},updated:function(){this.getposMap()},methods:{getposMap:function(){var t=this,e=this.elWarp.querySelectorAll("tr"),i=this.startIdx-this.bufferCount>0?this.startIdx-this.bufferCount:0,n=this.position[i-1]||0;e.forEach((function(e,r){n+=e.offsetHeight,t.posMap[i+r]=n,t.position[i+r]=n}))},getPosition:function(){var t=this,e=[],i=0;return this.data.map((function(n,r){var a=t.posMap[r];a?i=a:i+=t.estimatedHeight||t.itemHeight,e[r]=i})),this.position=e,e},getPosIdx:function(t){var e=this.position.findIndex((function(e){return t<=e}));return[e,this.position[e-1]?this.position[e]-this.position[e-1]:this.position[e],this.position[e]]}}},v={name:"eleTable",components:{eleColumn:f},mixins:[{data:function(){return{tableRef:null,warpperRef:null,elWarp:null,elItems:null,elTbody:null}},mounted:function(){this.getTableRef()},methods:{getTableRef:function(){var t=this;this.tableRef||(this.tableRef=this.$children[0],this.tableRef.$children.forEach((function(e){"ElTableBody"===e.$options.name&&(t.warpperRef=e)})),this.elTbody=this.warpperRef.$el.querySelector("tbody"),this.initProxy(),this.appendWarp())},initProxy:function(){var t=this,e=this.warpperRef.wrappedRowRender;this.warpperRef.wrappedRowRender=function(i,n){return e(i,n+t.bufferIdx)}},appendWarp:function(){var t=this.tableRef.$el;this.elWarp=document.createElement("div"),this.elWarp.className="ele-vertual-warp",this.elWarp.style.position="relative",this.elItems=document.createElement("div"),this.elItems.className="ele-vertual-warpItems",this.elItems.style.position="absolute",this.elItems.style.left="0px",this.elItems.style.top="0px";var e=t.querySelector(".el-table__body-wrapper"),i=e.querySelector("table");e.insertBefore(this.elWarp,i),this.elItems.appendChild(i),this.elWarp.appendChild(this.elItems);var n=t.querySelector(".el-table__fixed .el-table__fixed-body-wrapper");if(n){this.leftWarp=document.createElement("div"),this.leftWarp.className="ele-vertual-warp-right";var r=n.querySelector("table");n.insertBefore(this.leftWarp,r),this.leftWarp.appendChild(r)}var a=t.querySelector(".el-table__fixed-right .el-table__fixed-body-wrapper");if(a){this.rightWarp=document.createElement("div"),this.rightWarp.className="ele-vertual-warp-right";var o=a.querySelector("table");a.insertBefore(this.rightWarp,o),this.rightWarp.appendChild(o)}e.addEventListener("scroll",c.call(this,this.eventScroll,0))},initItemHeight:function(){if(this.itemHeight)return this.itemHeight;var t=this.elTbody.offsetHeight/(this.vCount+this.bufferCount);this.itemHeight=Math.round(t);var e=this.tableRef.$el.offsetHeight;return this.vCount=Math.ceil(e/t),this.elWarp.style.height=this.globalHeight+"px",this.itemHeight},getGloHeight:function(){return console.log(this.position,this.data.length-1,"globalHeight",this.position[this.data.length-1]||0),this.vertual?this.position[this.data.length-1]||0:this.data.length*this.itemHeight}}},{mounted:function(){this.initSelection()},methods:{initSelection:function(){if(!this.tableRef)throw new Error("MODULE-SELECTION: tableRef is undefined");var t=this;this.tableRef.store.toggleAllSelection=function(){var e=this.states;e.data;var i=e.selection,n=e.selectOnIndeterminate?!e.isAllSelected:!(e.isAllSelected||i.length);e.isAllSelected=n;var r=!1;t.data.forEach((function(t,a){e.selectable?e.selectable.call(null,t,a)&&p(i,t,n)&&(r=!0):p(i,t,n)&&(r=!0)})),r&&this.table.$emit("selection-change",i?i.slice():[]),this.table.$emit("select-all",i)},this.tableRef.store.updateAllSelected=function(){var e=this.states,i=e.selection,n=e.rowKey,r=e.selectable,a=t.data||[];if(0!==a.length){var o;n&&(o=d(i,n));for(var l,s=!0,u=0,h=0,f=a.length;h<f;h++){var c=a[h],p=r&&r.call(null,c,h);if(l=c,o?o[g(l,n)]:-1!==i.indexOf(l))u++;else if(!r||p){s=!1;break}}0===u&&(s=!1),e.isAllSelected=s}else e.isAllSelected=!1}}}},b],data:function(){return{itemHeight:0,vCount:5,startIdx:0,selections:[],WeakMap:new Map,posMap:[],btn:!0}},props:{data:{type:Array,default:function(){return[]}},columns:{type:Array,default:function(){return[]}},bufferCount:{type:Number,default:0}},computed:{vData:function(){var t=this.bufferIdx,e=this.startIdx+this.vCount+this.bufferCount;return this.data.slice(t,e)},bufferIdx:function(){return this.startIdx-this.bufferCount>0?this.startIdx-this.bufferCount:0},globalHeight:function(){return this.vertual?this.position[this.data.length-1]||0:(this.elWarp.style.height=this.data.length*this.itemHeight+"px",this.data.length*this.itemHeight)}},mounted:function(){var t=this;console.log("mounted",this),this.$nextTick((function(){t.updateAllData()}))},methods:{updateAllData:function(){var t=this;this.$nextTick((function(){t.initItemHeight(),t.getPosition(),t.getposMap(),t.eventScroll()}))},eventScroll:function(t){var e,i=(null==t||null===(e=t.target)||void 0===e?void 0:e.scrollTop)||0,n=0;if(!this.vertual){this.startIdx=Math.floor(i/this.itemHeight);var r=(this.startIdx-this.bufferIdx)*this.itemHeight;n=i-i%this.itemHeight-r}if(this.vertual){var a=u(this.getPosIdx(i),3),o=a[0],l=a[1],s=a[2];this.startIdx=o,n=s-l}this.elWarp.style.height=this.globalHeight-n+"px",this.elWarp.style.transform="translate3d(0, ".concat(n,"px, 0)")}},render:function(t){var e=this;return t("el-table",r([{attrs:{data:this.vData}},{attrs:this.$attrs},{},{on:this.$listeners}]),[this.columns.map((function(i){return t(f,r([{},{props:l(l({},i),{},{globalSlots:e.$slots})}]))})),t("template",{slot:"append"},[this.$slots.append])])}},m={name:"eleTableContainer",components:{eleTable:v},data:function(){return{loading:!1}},methods:{getAxios:function(){var t=this;this.loading=!0,this.getData().finally((function(){t.loading=!1}))},sizeChange:function(t){var e=this;this.pProps.pageSize=t,this.loading=!0,this.getData().finally((function(){e.loading=!1}))},currentChange:function(t){var e=this;this.pProps.currentPage=t,this.loading=!0,this.getData().finally((function(){e.loading=!1}))}},mounted:function(){this.getAxios()},computed:{tProps:function(){return this.$attrs},pProps:function(){return this.$attrs.pageOpt},getData:function(){return this.$attrs.getData}},render:function(t,e){return t("div",{class:"ele-table-container"},[t("ele-table",r([{},{props:this.tProps},{directives:[{name:"loading",value:this.loading}]}])),t("el-pagination",r([{},{props:this.pProps},{},{on:{"size-change":this.sizeChange,"current-change":this.currentChange}}]))])}};export{v as Table,m as TableContainer};
