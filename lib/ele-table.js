function t(){return t=Object.assign?Object.assign.bind():function(t){for(var e,r=1;r<arguments.length;r++)for(var i in e=arguments[r])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t},t.apply(this,arguments)}var e=["attrs","props","domProps"],r=["class","style","directives"],i=["on","nativeOn"],n=function(n){return n.reduce((function(n,l){for(var a in l)if(n[a])if(-1!==e.indexOf(a))n[a]=t({},n[a],l[a]);else if(-1!==r.indexOf(a)){var s=n[a]instanceof Array?n[a]:[n[a]],h=l[a]instanceof Array?l[a]:[l[a]];n[a]=[].concat(s,h)}else if(-1!==i.indexOf(a))for(var c in l[a])if(n[a][c]){var u=n[a][c]instanceof Array?n[a][c]:[n[a][c]],f=l[a][c]instanceof Array?l[a][c]:[l[a][c]];n[a][c]=[].concat(u,f)}else n[a][c]=l[a][c];else if("hook"===a)for(var p in l[a])n[a][p]=n[a][p]?o(n[a][p],l[a][p]):l[a][p];else n[a]=l[a];else n[a]=l[a];return n}),{})},o=function(t,e){return function(){t&&t.apply(this,arguments),e&&e.apply(this,arguments)}};function l(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,i)}return r}function a(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?l(Object(r),!0).forEach((function(e){s(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):l(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function s(t,e,r){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var i=r.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var h={name:"eleColumn",functional:!0,components:{eleColumn:h},render:function(t,e){var r=e.props,i=r.globalSlots||null;return t("el-table-column",n([{},{props:r},{scopedSlots:function(t,e){return e.render?{default:function(r){return e.render(t,r)}}:{}}(t,r)}]),[r.children?r.children.map((function(e){return t(h,n([{},{props:a(a({},e),{},{globalSlots:i})}]))})):null])}};function c(t,e,r){var i=!1,n=t.indexOf(e),o=-1!==n,l=function(){t.push(e),i=!0},a=function(){t.splice(n,1),i=!0};return"boolean"==typeof r?r&&!o?l():!r&&o&&a():o?a():l(),i}var u=function(t,e){var r={};return(t||[]).forEach((function(t,i){r[f(t,e)]={row:t,index:i}})),r},f=function(t,e){if(!t)throw new Error("row is required when get row identity");if("string"==typeof e){if(e.indexOf(".")<0)return t[e];for(var r=e.split("."),i=t,n=0;n<r.length;n++)i=i[r[n]];return i}if("function"==typeof e)return e.call(null,t)};function p(t,e){var r=null;return function(){for(var i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];r||(r=setTimeout((function(){t.apply(void 0,n),r=null}),e))}}var d={name:"eleTable",components:{eleColumn:h},mixins:[{mounted:function(){this.initSelection()},methods:{initSelection:function(){if(!this.tableRef)throw new Error("tableRef is error");var t=this;this.tableRef.store.toggleAllSelection=function(){var e=this.states;e.data;var r=e.selection,i=e.selectOnIndeterminate?!e.isAllSelected:!(e.isAllSelected||r.length);e.isAllSelected=i;var n=!1;t.data.forEach((function(t,o){e.selectable?e.selectable.call(null,t,o)&&c(r,t,i)&&(n=!0):c(r,t,i)&&(n=!0)})),n&&this.table.$emit("selection-change",r?r.slice():[]),this.table.$emit("select-all",r)},this.tableRef.store.updateAllSelected=function(){var e=this.states,r=e.selection,i=e.rowKey,n=e.selectable,o=t.data||[];if(0!==o.length){var l;i&&(l=u(r,i));for(var a,s=!0,h=0,c=0,p=o.length;c<p;c++){var d=o[c],g=n&&n.call(null,d,c);if(a=d,l?l[f(a,i)]:-1!==r.indexOf(a))h++;else if(!n||g){s=!1;break}}0===h&&(s=!1),e.isAllSelected=s}else e.isAllSelected=!1}}}}],data:function(){return{item:[],tableRef:null,warpperRef:null,elWarp:null,elItems:null,elWarpHeight:null,itemHeight:48,itemHeightArr:[],vCount:7,bufferCount:2,bufferHeight:0,startIdx:0,selections:[],WeakMap:new Map,position:[],btn:!0}},props:{data:{type:Array,default:function(){return[]}},columns:{type:Array,default:function(){return[]}}},watch:{data:function(t){this.elWarp.style.height=this.elItems*t.length+"px"}},computed:{vData:function(){var t=this.bufferIdx,e=this.startIdx+this.vCount+this.bufferCount;return this.data.slice(t,e)},bufferIdx:function(){return this.startIdx-this.bufferCount>0?this.startIdx-this.bufferCount:0},globalHeight:function(){return this.data.length*this.itemHeight}},mounted:function(){this.initProxy(),console.log("mounted")},updated:function(){var t=this;console.log("updated"),this.$nextTick((function(){t.observerCB(null,!0)}))},methods:{initProxy:function(){var t=this,e=this.warpperRef.wrappedRowRender;this.warpperRef.wrappedRowRender=function(r,i){return e(r,i+t.bufferIdx)}},refCallBack:function(t){var e=this;this.tableRef||(this.tableRef=t,this.tableRef.$children.forEach((function(t){"ElTableBody"===t.$options.name&&(e.warpperRef=t)})),this.tbody=this.warpperRef.$el.querySelectorAll("tbody"),this.$nextTick((function(){e.appendWarp()})))},appendWarp:function(){var t=this,e=this.tableRef.$el;this.elWarp=document.createElement("div"),this.elWarp.className="ele-vertual-warp",this.elWarp.style.height=this.globalHeight+"px",this.elWarp.style.position="relative",this.elItems=document.createElement("div"),this.elItems.className="ele-vertual-warpItems",this.elItems.style.position="absolute",this.elItems.style.left="0px",this.elItems.style.top="0px";var r=e.querySelector(".el-table__body-wrapper"),i=r.querySelector("table");r.insertBefore(this.elWarp,i),this.elItems.appendChild(i),this.elWarp.appendChild(this.elItems);var n=e.querySelector(".el-table__fixed .el-table__fixed-body-wrapper");if(n){this.leftWarp=document.createElement("div"),this.leftWarp.className="ele-vertual-warp-right",this.leftWarp.style.height=this.globalHeight+"px";var o=n.querySelector("table");n.insertBefore(this.leftWarp,o),this.leftWarp.appendChild(o)}var l=e.querySelector(".el-table__fixed-right .el-table__fixed-body-wrapper");if(l){this.rightWarp=document.createElement("div"),this.rightWarp.className="ele-vertual-warp-right",this.rightWarp.style.height=this.globalHeight+"px";var a=l.querySelector("table");l.insertBefore(this.rightWarp,a),this.rightWarp.appendChild(a)}setTimeout((function(){t.observerCB(null,!0),t.itemHeight=r.querySelector("tr").offsetHeight,console.log(r.querySelector("tr").offsetHeight,"clientHeight",i.clientHeight/13)}));var s=p.call(this,this.eventScroll,10);r.addEventListener("scroll",s)},observer:function(){var t=this.elWarp.querySelector("table");new MutationObserver(this.observerCB).observe(t,{subtree:!0,childList:!0})},observerCB:function(t){var e=this,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=this.bufferIdx;!t&&r?(this.elWarp.querySelectorAll("tr").forEach((function(t){var r=t.getBoundingClientRect().height,n=i-1;e.position[i]=n>=0?{index:i,height:r,top:e.position[n].bottom,bottom:r+e.position[n].bottom}:{index:i,height:r,top:0,bottom:r},i++})),console.log(this.position)):t.forEach((function(t){t.addedNodes.length&&t.addedNodes.forEach((function(t){var r=t.getBoundingClientRect().height,n=i-1;e.position[i]=n>=0?{index:i,height:r,top:e.position[n].bottom,bottom:r+e.position[n].bottom}:{index:i,height:r,top:0,bottom:r},i++}))}));console.log("observe",this.position)},eventScroll:function(t){var e=t.target.scrollTop;console.log(this.position);var r=this.position.find((function(t){return t.bottom>e&&e>=t.top}));console.log(r.index,"current",e),this.startIdx=r.index,this.itemHeight=r.height,r.top;var i=e-e%r.height;this.elWarp.style.height=this.globalHeight-i+"px",this.elWarp.style.transform="translate3d(0, ".concat(i,"px, 0)"),this.leftWarp&&(this.leftWarp.style.height=this.globalHeight-i+"px",this.leftWarp.style.transform="translate3d(0, ".concat(i,"px, 0)")),this.rightWarp&&(this.rightWarp.style.height=this.globalHeight-i+"px",this.rightWarp.style.transform="translate3d(0, ".concat(i,"px, 0)"))}},render:function(t){var e=this;return this.$attrs,t("el-table",n([{attrs:{data:this.vData}},{attrs:this.$attrs},{ref:this.refCallBack},{on:this.$listeners}]),[this.columns.map((function(r){return t(h,n([{},{props:a(a({},r),{},{globalSlots:e.$slots})}]))})),t("template",{slot:"append"},[this.$slots.append])])}},g={name:"eleTableContainer",components:{eleTable:d},data:function(){return{loading:!1}},methods:{getAxios:function(){var t=this;this.loading=!0,this.getData().finally((function(){t.loading=!1}))},sizeChange:function(t){var e=this;this.pProps.pageSize=t,this.loading=!0,this.getData().finally((function(){e.loading=!1}))},currentChange:function(t){var e=this;this.pProps.currentPage=t,this.loading=!0,this.getData().finally((function(){e.loading=!1}))}},mounted:function(){this.getAxios()},computed:{tProps:function(){return this.$attrs},pProps:function(){return this.$attrs.pageOpt},getData:function(){return this.$attrs.getData}},render:function(t,e){return t("div",{class:"ele-table-container"},[t("ele-table",n([{},{props:this.tProps},{directives:[{name:"loading",value:this.loading}]}])),t("el-pagination",n([{},{props:this.pProps},{},{on:{"size-change":this.sizeChange,"current-change":this.currentChange}}]))])}};export{d as Table,g as TableContainer};
